name: Strava sync cron

on:
  schedule:
    # Every 30 minutes
    - cron: '*/30 * * * *'
  workflow_dispatch:

jobs:
  sync:
    runs-on: ubuntu-latest
    timeout-minutes: 10

    steps:
      - name: Trigger CoachKit Strava cron
        env:
          CRON_SECRET: ${{ secrets.COACHKIT_CRON_SECRET }}
        run: |
          if [ -z "$CRON_SECRET" ]; then
            echo "Missing secrets.COACHKIT_CRON_SECRET" >&2
            exit 1
          fi

          curl -sS -X POST \
            -H "authorization: Bearer $CRON_SECRET" \
            "https://coach-kit.vercel.app/api/integrations/strava/cron" \
            | head -c 4000
